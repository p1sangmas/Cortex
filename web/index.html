<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cortex</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <!-- Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.3/dist/purify.min.js"></script>
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <button class="new-chat-btn" onclick="location.reload()">
            <i class="fas fa-plus"></i>
            New chat
        </button>

        <div class="sidebar-section">
            <!-- Items removed as requested -->
        </div>

        <div class="sidebar-footer">
            <div class="sidebar-item" id="system-info-trigger">
                <i class="fas fa-cog"></i>
                Settings
            </div>
            <div class="sidebar-item" id="user-btn-trigger">
                <i class="fas fa-user"></i>
                User
            </div>
            <div class="sidebar-item" id="view-docs-btn" style="font-size: 0.75rem; color: #666; cursor: pointer;">
                <span id="doc-count">0</span> documents loaded
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar (Model Selector) -->
        <div class="top-bar">
            <div class="model-selector" id="model-selector-btn">
                <span id="current-model-text">Traditional</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <!-- Tooltip/Dropdown Menu would go here (simulated with standard select for now or custom div) -->
            <div id="model-dropdown" class="model-dropdown hidden">
                <div class="model-option selected" data-value="traditional">
                    <div class="model-icon"><i class="fas fa-bolt"></i></div>
                    <div class="model-info">
                        <div class="model-name">Cortex</div>
                        <div class="model-desc">Standard Retrieval Augmented Generation</div>
                    </div>
                    <i class="fas fa-check check-icon"></i>
                </div>
                <div class="model-option" data-value="agentic">
                    <div class="model-icon"><i class="fas fa-robot"></i></div>
                    <div class="model-info">
                        <div class="model-name">Cortex Agentic</div>
                        <div class="model-desc">Multi-step reasoning and tool use</div>
                    </div>
                    <i class="fas fa-check check-icon hidden"></i>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="empty-state">
            <h1>What's on your mind today?</h1>
        </div>

        <!-- Chat Messages -->
        <!-- Chat Messages -->
        <div id="chat-messages" style="flex: 1; padding-bottom: 20px; overflow-y: auto;"></div>

        <!-- Floating Input Area -->
        <div class="input-area-container">
            <div class="input-box-wrapper">
                <!-- Upload Button Icon -->
                <div class="upload-btn-wrapper" onclick="document.getElementById('file-upload').click()">
                    <i class="fas fa-plus"></i>
                </div>
                <textarea id="chat-input" placeholder="Ask anything" rows="1"></textarea>
                <button id="send-btn" disabled>
                    <i class="fas fa-arrow-up"></i>
                </button>
            </div>
        </div>
    </div>
    <input type="file" id="file-upload" multiple accept=".pdf" class="hidden">

    <div id="modal-overlay" class="modal-overlay hidden">
        <!-- Settings Modal (Reduced) -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-modal-btn" onclick="closeModals()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p>Embedding Model: <span id="embed-model">default</span></p>
                <!-- RAG Mode moved to top bar -->
                <p>Ollama Status: <span id="ollama-status">Checking...</span></p>
                <hr style="border-color: var(--border-color); margin: 1rem 0;">
                <button class="new-chat-btn" id="clear-kb-btn"
                    style="width: 100%; justify-content: center; color: var(--danger-color); border-color: var(--danger-color);">
                    <i class="fas fa-trash"></i> Clear Knowledge Base
                </button>
            </div>
        </div>

        <!-- Documents List Modal -->
        <div id="documents-modal" class="modal hidden">
            <div class="modal-header">
                <h2>Uploaded Documents</h2>
                <button class="close-modal-btn" onclick="closeModals()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="modal-drop-zone" class="modal-drop-zone"
                    onclick="document.getElementById('file-upload').click()">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 1.5rem; margin-bottom: 10px;"></i><br>
                    <span>Click or drag PDF files here to upload</span>
                </div>
                <div id="modal-file-list" class="file-list-container">
                    <!-- Files will be injected here -->
                </div>
            </div>
        </div>

        <!-- User Session Modal -->
        <div id="user-modal" class="modal hidden">
            <div class="modal-header">
                <h2>User Session</h2>
                <button class="close-modal-btn" onclick="closeModals()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 0.5rem; color: var(--text-secondary);">Current Session ID:</p>
                <div
                    style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; font-family: monospace; display: flex; align-items: center; justify-content: space-between;">
                    <span id="session-id-display">...</span>
                    <i class="fas fa-copy" onclick="copySessionId()" style="cursor: pointer; opacity: 0.7;"
                        title="Copy to clipboard"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"
        style="position: fixed; bottom: 20px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px;">
    </div>

    <!-- Legacy script refs adapted -->
    <script src="js/app.js"></script>
    <script>
        // Simple helper for empty state cards
        function setInput(text) {
            const input = document.getElementById('chat-input');
            input.value = text;
            input.focus();
        }

        // Toggle Settings
        const systemInfoTrigger = document.getElementById('system-info-trigger');
        if (systemInfoTrigger) {
            systemInfoTrigger.addEventListener('click', () => {
                document.getElementById('modal-overlay').classList.remove('hidden');
                document.getElementById('settings-modal').classList.remove('hidden');
            });
        }

        document.querySelectorAll('.close-modal-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('modal-overlay').classList.add('hidden');
                document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
            });
        });

        // Trigger file upload from sidebar
        const fileUploadTrigger = document.getElementById('file-upload-trigger');
        if (fileUploadTrigger) {
            fileUploadTrigger.addEventListener('click', () => {
                document.getElementById('file-upload').click();
            });
        }

        // Auto-resize textarea
        const textarea = document.getElementById('chat-input');
        if (textarea) {
            textarea.addEventListener('input', function () {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                if (this.value === '') this.style.height = 'auto';
            });
        }
    </script>
</body>

</html>